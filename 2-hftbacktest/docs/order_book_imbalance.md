# Order Book Imbalance (OBI) 개념과 활용

이 문서는 HFT(고빈도 매매)의 핵심 개념 중 하나인 **주문장 불균형(Order Book Imbalance, OBI)**에 대해 설명합니다.

## HFT의 기초: 마이크로스트럭처와 정보

HFT 전략은 시장의 미시적인 구조(Microstructure)에서 발생하는 단기적인 가격 변동 예측을 목표로 합니다. 이때, 오더북(호가창)은 가장 중요한 정보 소스입니다. 오더북에는 특정 자산에 대한 모든 매수(Bid) 및 매도(Ask) 주문이 가격대별로 누적되어 있으며, 이는 시장 참여자들의 총 수요와 공급을 나타냅니다.

OBI는 이 수요와 공급의 불균형을 수치화한 지표로, 단기적인 가격 움직임을 예측하는 데 매우 유용하게 사용됩니다.

## 1. 주문장 불균형 (Order Book Imbalance, OBI)

OBI는 특정 시점에서 매수 압력과 매도 압력 간의 상대적인 힘을 측정하는 지표입니다. 가장 기본적인 형태의 OBI는 **최우선 호가(Best Bid/Ask)**의 주문량만을 사용하여 계산됩니다.

### 계산 공식

OBI는 다음과 같이 계산할 수 있습니다.

```
OBI = (최우선 매수 주문량) / (최우선 매수 주문량 + 최우선 매도 주문량)
```

- **최우선 매수 주문량 (Best Bid Volume)**: 가장 높은 매수 호가에 쌓여있는 총 주문량
- **최우선 매도 주문량 (Best Ask Volume)**: 가장 낮은 매도 호가에 쌓여있는 총 주문량

**해석:**
- **OBI > 0.5**: 매수 압력이 매도 압력보다 강함을 의미하며, 단기적으로 가격이 상승할 가능성이 높다고 해석할 수 있습니다.
- **OBI < 0.5**: 매도 압력이 매수 압력보다 강함을 의미하며, 단기적으로 가격이 하락할 가능성이 높다고 해석할 수 있습니다.
- **OBI = 0.5**: 매수와 매도 압력이 균형을 이루고 있음을 의미합니다.

**예시:**
- 최우선 매수 주문량: 10 BTC
- 최우선 매도 주문량: 5 BTC
- `OBI = 10 / (10 + 5) = 10 / 15 ≈ 0.67`
- 이 경우, 매수 압력이 강하므로 가격 상승을 예측할 수 있습니다.

## 2. 다중 레벨 주문장 불균형 (Multi-Level OBI)

최우선 호가만 보는 것은 전체 오더북의 상태를 완전히 반영하지 못할 수 있습니다. 예를 들어, 최우선 매도 호가에는 적은 물량만 있지만 바로 다음 호가에 엄청난 물량이 쌓여있을 수 있습니다.

**다중 레벨 OBI(Multi-Level OBI)**는 이러한 한계를 극복하기 위해 오더북의 여러 레벨(level)에 걸친 주문량을 모두 고려하여 불균형을 계산합니다.

### 계산 공식

N 레벨까지의 OBI는 다음과 같이 계산됩니다.

```
OBI(N) = (Sum of Bid Volumes up to N levels) / (Sum of Bid Volumes up to N levels + Sum of Ask Volumes up to N levels)
```

- **`Sum of Bid Volumes up to N levels`**: 최우선 매수 호가부터 N번째 매수 호가까지의 모든 주문량의 합
- **`Sum of Ask Volumes up to N levels`**: 최우선 매도 호가부터 N번째 매도 호가까지의 모든 주문량의 합

가중치를 부여하여 최근 호가에 더 높은 중요도를 부여하는 방식도 많이 사용됩니다. 예를 들어, 각 레벨의 가격 차이(price level)에 반비례하는 가중치를 곱하여 합산할 수 있습니다.

**가중 OBI (Weighted OBI):**
각 레벨 `i`의 매수/매도 가격을 `P_bid(i)`, `P_ask(i)`라 하고, 주문량을 `V_bid(i)`, `V_ask(i)`라고 할 때 가중 OBI는 다음과 같이 계산할 수 있습니다.

```
Weighted OBI = (∑ w(i) * V_bid(i)) / (∑ w(i) * V_bid(i) + ∑ w(i) * V_ask(i))
```
- `w(i)`: 레벨 `i`에 대한 가중치. (예: `1/i` 또는 `1/log(i)`)

다중 레벨 OBI는 더 깊은 시장의 수요와 공급 상태를 반영하므로, 단일 레벨 OBI보다 더 안정적이고 신뢰도 높은 예측을 제공하는 경향이 있습니다.

## 3. OBI와 HFT 전략

OBI는 HFT에서 다음과 같이 활용됩니다.

1.  **단기 가격 예측 (Short-term Price Prediction)**
    - OBI는 수십-수백 밀리초(ms) 단위의 매우 짧은 시간 동안의 가격 방향을 예측하는 강력한 피처(feature)로 사용됩니다.
    - 머신러닝 모델의 주요 입력 피처로 활용하여, OBI 값이 특정 임계치를 넘을 때 매수 또는 매도 신호를 생성할 수 있습니다.

2.  **시장 조성 (Market Making)**
    - 시장 조성자는 OBI를 참고하여 자신의 매수/매도 호가 스프레드를 동적으로 조절합니다.
    - 예를 들어, 매수 압력이 높으면(OBI > 0.5), 매도 호가를 약간 올리거나 매수 호가를 타이트하게 조절하여 재고 위험(inventory risk)을 관리합니다.

3.  **통계적 차익거래 (Statistical Arbitrage)**
    - 여러 거래소 또는 여러 자산 간의 OBI를 비교하여 일시적인 가격 불일치를 포착하고 차익거래 기회를 탐색합니다.

### OBI 활용 시 주의사항

- **레이턴시**: OBI는 매우 빠르게 변하므로, 정보를 계산하고 주문을 실행하기까지의 지연 시간(latency)이 매우 중요합니다.
- **데이터 품질**: 정확한 틱 데이터를 사용해야 신뢰도 높은 OBI 값을 얻을 수 있습니다.
- **과적합 (Overfitting)**: 특정 기간의 데이터에만 잘 맞는 OBI 임계값이나 모델을 만들지 않도록 주의해야 합니다.

결론적으로 OBI는 오더북 데이터의 핵심 정보를 압축하여 미래 가격 움직임을 예측하는 데 사용되는 강력한 도구이며, 수많은 HFT 전략의 기초를 이룹니다.
